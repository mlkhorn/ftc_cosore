---
title: "COSORE Winter Rs Analysis"
author: "Mercedes Horn"
date: "6/15/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Overall Science Question
Question:

## Sub Hypotheses:
H1:
H2:
H3:


# Loading Packages

```{r Load-Packages }
library(dplyr)
library(ggplot2)
library(tidyr)
library(lubridate)
library(devtools)
library(remotes)
library(cosore)

source("FTFindUsefulData.R")
```
 
# Functions
 
```{r Functions}
# Here is where we will write out functions we need

# Possibly a function to pull out data across FT-boundary

# Possibly a function to pull out sites that have snow fall/cover data
 
```

# Load Data

winterdata_names holds the names of the 8 datasets that have a full year of data and have a winter period that matches our definition. 

winterdata holds the data tables of all the datasets in winter_datanames

winterdata_full holds all the data of all the datasets in winterdata_names

```{r Load-data}
#This is where we would load the data we are going to analyze

winterdata_names

winterdata <- list()
for (i in 1:length(winterdata_names)) {
  winterdata[[i]]<- csr_dataset(winterdata_names[i])$data
}

winterdata_full <- list()
for (i in 1:length(winterdata_names)) {
  winterdata_full[[i]]<- csr_dataset(winterdata_names[i])
}

```

# Clean Data

```{r Clean-Data }

```


# Calculate Number of Freeze Thaw Crossings 

```{r Freeze-Thaw-Crossings }

ft_event_count<-c()

for(i in 1:length(winterdata_names)){
  
  print(winterdata_names[i])
  
  ds<-winterdata_full[[i]]$data
  
  ds %>%
    select(CSR_TIMESTAMP_BEGIN,CSR_T5) %>%
    mutate(day=yday(CSR_TIMESTAMP_BEGIN),
           year=year(CSR_TIMESTAMP_BEGIN)) -> ds1
  
  ds1 %>%
      filter(!is.na(CSR_T5)) %>%
      group_by(year,day) %>%
      summarise(CSR_TIMESTAMP=mean(CSR_TIMESTAMP_BEGIN),                    
                T5_min=min(CSR_T5)) -> ds2
  
  ds2 %>%
    mutate(sign=sign(T5_min)) -> ds3
    
  ftchange<-ds3$sign[-1]!=ds3$sign[-length(ds3$sign)]
  
  ft_number<-(sum(ftchange))/2
  
  ft_event_count[i] <- ft_number
  
}

ft_events<-data.frame("dataset"=winterdata_names,
                     "FT_events"=ft_event_count)



```


# Hypothesis 1

```{r H-1}

```

# Hypothesis 2

```{r H-2}

```

# Hypothesis 3

```{r H-3}

```
